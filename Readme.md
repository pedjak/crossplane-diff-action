# Crossplane Dynamic Diff Workflow

## Introduction

This GitHub Actions workflow, named "Crossplane Dynamic Diff," automates the comparison of changes between pull requests and the main branch for specific input files. It utilizes Crossplane CLI (version >= 1.14.0) to render YAML files and generates a diff between the pull request and main branch outputs.

## Workflow Overview

The workflow consists of two main jobs: `pr` and `main`. Here's a breakdown of each job:

### `pr` Job

1. **Prepare Environment:**
   - Sets up QEMU.
   - Checks out the current commit.
   - Installs Go and Crossplane CLI (`crank`).

2. **Split Input Files:**
   - Splits the input files specified in the environment variable into an array.

3. **Run Dynamic Jobs:**
   - Iterates over each input file.
   - Renders the file using Crossplane CLI and appends the output to a corresponding diff file.
   - Outputs the diff files as artifacts.

### `main` Job

1. **Prepare Environment:**
   - Sets up QEMU.
   - Checks out the main branch.

2. **Download Artifacts:**
   - Downloads the diff artifacts generated by the `pr` job.

3. **Run Dynamic Jobs on Main:**
   - Iterates over each input file.
   - Renders the file on the main branch using Crossplane CLI and appends the output to a corresponding diff file.
   - Outputs the main branch diff files as artifacts.

4. **Diff Outputs:**
   - Compares the outputs between the pull request and main branch for each input file.
   - Stores the differences in environment variables.

5. **Auto Comment:**
   - Auto-comments on the pull request with the generated code diff.

## Usage

To use this workflow:

1. Ensure that the workflow file is placed in the `.github/workflows/` directory in your repository.

2. Set the `INPUT_FILES` environment variable with the desired input files (comma-separated).

3. Trigger the workflow by creating or updating a pull request.

## Notes

- Ensure that Crossplane CLI version is 1.14.0 or later. Update the installation step if needed.

- The workflow utilizes the `wow-actions/auto-comment` action to automatically comment on the pull request with the generated code diff.

## Contact

If you have any questions or encounter issues, feel free to contact the repository maintainer. Happy automating!